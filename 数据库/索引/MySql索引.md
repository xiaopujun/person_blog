# 索引

![](D:\study\person_blog\数据库\索引\Mysql索引.png)

MySQL 索引是一种数据结构，用于加快查询速度。它类似于书籍的目录，可以快速定位到某个关键字对应的数据行。MySQL 索引可以在查询时提供快速的访问路径，从而减少全表扫描的开销，提高查询效率。

## 原理

MySQL 索引的原理是通过创建一个索引数据结构，将索引列的值映射到对应的数据行位置，然后通过索引数据结构来定位符合查询条件的数据行，从而避免了全表扫描的过程。MySQL 支持多种索引类型，包括：

## 分类

建立方式上分为：

1. 主键索引：primary key。定为主键后，数据库自动建立索引，InnoDB为聚簇索引，主键索引列值不能为空（Null）。
2. 唯一索引：索引列的值必须唯一，但允许有空值（Null），但只允许有一个空值（Null）。
3. 复合索引：一个索引可以包含多个列，多个列共同构成一个复合索引。
4. 全文索引：Full Text（MySQL5.7之前，只有MYISAM存储引擎引擎支持全文索引）。全文索引类型为FULLTEXT，在定义索引的列上支持值的全文查找允许在这些索引列中插入重复值和空值。全文索引可以在Char、VarChar
   上创建。
5. 前缀索引：在文本类型为char、varchar、text类列上创建索引时，可以指定索引列的长度，但是数值类型不能指定。

实现方式上分为：

1. B-Tree 索引：是最常用的索引类型，可以用于普通列、唯一列和主键列。它使用平衡树结构来存储索引数据，可以快速定位到符合条件的数据行。
2. Hash 索引：适用于等值比较查询，使用哈希表结构来存储索引数据，可以快速定位到符合条件的数据行。但是，Hash 索引不支持范围查询和排序操作。
3. Full-Text 索引：适用于全文搜索，可以快速查找包含特定单词或短语的文本数据。
4. R-Tree 索引：适用于空间数据查询，例如地理位置数据、图片数据等。

## 操作索引

```sql
-- 查看索引
show
index from 表名;

-- 创建单列索引，只能包含一个字段
create index name_index on table (target_field);

-- 创建唯一索引，只能有一个列
create unique index age_index on user (age);

-- 复合索引
create index name_age_index on user (name, age);

```

## 索引的数据结构

MySQL索引使用的数据结构主要有BTree索引和hash索引。 对于hash索引来说，底层的数据结构就是哈希表，因此在绝大多数需求为单条记录查询的时候，可以选择哈希索引，查询性能最快；其余大部分场景建议选择BTree索引。
根据存储引擎的不同，实现方式也不同

### B+Tree索引

MySQL的索引数据结构最常使用的是B树中的B+Tree，但对于主要的两种存储引擎的实现方式是不同的。InnoDB中data阈存储的是行数据，而MyISAM中存储的是磁盘地址

- MyISAM:
  B+Tree叶节点的data域存放的是数据记录的地址。在索引检索的时候，首先按照B+Tree搜索算法搜索索引，如果指定的Key存在，则根据data域中磁盘地址到磁盘中寻址定位到对应的磁盘块，然后读取相应的数据记录，这被称为“非聚簇索引”。B+Tree叶节点的data域存放的是数据记录的地址。在索引检索的时候，首先按照B+Tree搜索算法搜索索引，如果指定的Key存在，则根据data域中磁盘地址到磁盘中寻址定位到对应的磁盘块，然后读取相应的数据记录，这被称为“非聚簇索引”。


- InnoDB：
  其数据文件本身就是索引文件。相比MyISAM，索引文件和数据文件是分离的，其表数据文件本身就是按照B+Tree组织的一个索引结构，树的叶节点data域保存了完整的数据记录。这个索引的Key是数据表的主键，因此InnoDB表数据文件本身就是主索引。这被称为“聚簇索引（聚集索引）”。而其余的索引都作为辅助索引，辅助索引的data域存储相应记录主键的值而不是地址，这也是和MyISAM不同的地方

    - 在根据主索引搜索时，直接找到Key所在的节点即可取出数据；
    - 在根据辅助索引查找时，则需要先取出主键的值，再走一遍主索引。
    - 因此在设计表的时候，不建议使用过长的字段作为主键，也不建议使用非单调的字段作为主键，这样会造成主索引频繁分裂。

### Hash索引

Hash表，在Java中的HashMap，TreeMap就是Hash表结构，以键值对的形式存储数据。我们使用hash表存储表数据结构，Key可以存储索引列，Value可以存储行记录或者行磁盘地址。Hash表在等值查询时效率很高，时间复杂度为O(
1)；但是不支持范围快速查找，范围查找时只能通过扫描全表的方式，筛选出符合条件的数据。

### mysql B+Tree索引的进化过程

[https://developer.aliyun.com/article/831250](https://developer.aliyun.com/article/831250)

## 注意事项

1. 索引并不是越多越好，过多的索引可能会影响数据的插入、更新和删除操作的性能，甚至可能导致索引失效。
2. 对于较小的表或经常进行全表扫描的查询，不应该创建索引，因为这会增加额外的开销，反而会降低查询效率。
3. 对于经常用于查询的列，应该创建索引，以提高查询效率。
4. 在设计索引时应该考虑查询的频率、查询条件的复杂度、表的大小等因素，以达到最优的查询性能。**